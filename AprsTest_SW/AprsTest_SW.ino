/*
 * 
 */

#include <math.h>

const float baudAdj=1.0;
const float adj1200=1.0;
const float adj2400=1.0;
const float tc1200=baudAdj*adj1200*1000000.0/1200.0;
const float tc2400=baudAdj*adj2400*1000000.0/2400.0;
const unsigned int delay_1200=(unsigned int)(0.5*tc1200);
const unsigned int delay_2400=(unsigned int)(0.5*tc2400);

const char aprs_bits[]={
  "00000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001\
  0000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001\
  0000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001\
  0000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001\
  0000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001\
  0000000100000001000000010000000100000001001010110101001101001011011011001101000101001110101011110010001101001011\
  0010111011101100101101001011101101010001000011001101101101001011001101001001000101010110011011100010101010100000\
  0100000101010001011100010010111011001110100001101110111011001110111011001111100100101110101011101000111010110001\
  0110111010000110100011101110111011001011010100010101011010100100110010001011100010111000111110001110010011000111\
  01111111011"};

void set_wave_1200(void)
{
  digitalWrite(2,HIGH);
  delayMicroseconds(delay_1200);
  digitalWrite(2,LOW);
  delayMicroseconds(delay_1200);
}

void set_wave_2400(void)
{
  digitalWrite(2,HIGH);
  delayMicroseconds(delay_2400);
  digitalWrite(2,LOW);
  delayMicroseconds(delay_2400);
  digitalWrite(2,HIGH);
  delayMicroseconds(delay_2400);
  digitalWrite(2,LOW);
  delayMicroseconds(delay_2400);
}

void send_bits(void)
{
  for(int j=0;j<sizeof(aprs_bits);j++)
  {
    if(aprs_bits[j]=='1')
      set_wave_1200();
    else if(aprs_bits[j]=='0')
      set_wave_2400();
  }
}

void setup() {
  pinMode(LED_BUILTIN, OUTPUT);
  Serial.begin(9600);
  
  pinMode(2, OUTPUT);
}

void loop() {
  delay(1000);
  send_bits();
}
